# Node.js MCP Server Best Practices & Integration - glm-4.7
*Mode: deep-search*

<metadata>
Messages: 2 | Tokens: 21,316
Outils: click, finish, search
</metadata>

--------------------------------------------------

## User
Search for latest best practices to create node js mcp server and determine how to create a new mcp server which would have ask_perplexity to send an api call to pplx pro and ask_gemini_pro to ask gemini pro 3 avec web research d'activ√©e; ou ask_gemini_flash pour gemini flash 3

## Assistant
<reasoning_trace>
1. I need to search for the latest best practices for creating a Node.js MCP (Model Context Protocol) server. This will help me understand how to create a new MCP server with specific functionalities like ask_perplexity for sending API calls to pplx pro and ask_gemini_pro for interacting with Gemini Pro 3 with web research enabled, or ask_gemini_flash for Gemini Flash 3.
Let me start by searching for information about MCP servers and their creation best practices. 
I need to search for the latest best practices for creating a Node.js MCP (Model Context Protocol) server. This will help me understand how to create a new MCP server with specific functionalities like ask_perplexity for sending API calls to pplx pro and ask_gemini_pro for interacting with Gemini Pro 3 with web research enabled, or ask_gemini_flash for Gemini Flash 3.
Let me start by searching for information about MCP servers and their creation best practices.
2. Great! I found some relevant information about MCP servers. Let me click on a few of these links to get more detailed information about building MCP servers in Node.js and the current best practices.
Let me start with the official MCP documentation and the comprehensive guides.
3. Great! This is a comprehensive guide for building MCP servers. I can see that this documentation provides both Python and TypeScript/JavaScript examples. Now let me check more specific information about Node.js MCP servers and the specific features I need to implement.
Let me click on another link to get more information about Node.js specific implementations.
4. This is very helpful! I'm getting a comprehensive understanding of how to build MCP servers in Node.js. Let me continue reading this guide and also search for more specific information about integrating with Perplexity API and Gemini API, since the user specifically wants to create tools for:
1. `ask_perplexity` - to send API calls to pplx pro
2. `ask_gemini_pro` - to ask Gemini Pro 3 with web research enabled
3. `ask_gemini_flash` - for Gemini Flash 3
Let me search for information about these specific APIs.
5. Let me click on the official Perplexity API documentation to understand how to use it.
6. This seems to be a cached snapshot and doesn't show the full documentation. Let me try to search for more specific information about the Perplexity API and also search for Gemini API documentation.
7. Let me click on the official Gemini API documentation to understand how to use it.
8. Perfect! Now I have good information about both the Gemini API and MCP server development. Let me also search for more specific information about the Perplexity API to understand how to use it properly.
9. I see there's a mention of an MCP Server for the Perplexity API on GitHub. Let me search for that specifically to see if there's already an implementation I can learn from.
10. Excellent! Let me click on the official Perplexity MCP server implementation to understand how it's built.
11. Perfect! This gives me a great understanding of how to create an MCP server for Perplexity. Now let me search for more specific information about creating a custom MCP server that combines both Perplexity and Gemini APIs, since the user wants to create a server with tools for both services.
Let me also look for information about how to implement web research with Gemini API, since the user specifically mentioned "ask_gemini_pro to ask gemini pro 3 avec web research d'activ√©e" (with web research enabled).
12. Great! Let me click on the official documentation about grounding with Google Search to understand how to enable web search in the Gemini API.
13. The link seems to be broken. Let me try another one to understand how to use Google Search with Gemini API.
14. Excellent! Now I have a good understanding of how to implement both Perplexity and Gemini APIs with web search capabilities. Let me now create a comprehensive guide for creating a Node.js MCP server that includes:
1. `ask_perplexity` - to send API calls to pplx pro
2. `ask_gemini_pro` - to ask Gemini Pro 3 with web research enabled
3. `ask_gemini_flash` - for Gemini Flash 3
Let me also search for any additional best practices for MCP server development.
---
15. Perfect! Now I have comprehensive information about MCP server development, security best practices, and how to integrate both Perplexity and Gemini APIs. Let me create a complete guide for creating a Node.js MCP server with the requested functionality.
Based on all the information I've gathered, I'll now provide a comprehensive answer that includes:
1. Latest best practices for creating Node.js MCP servers
2. How to create a new MCP server with the specific tools requested
3. Implementation details for each tool (ask_perplexity, ask_gemini_pro, ask_gemini_flash)
4. Security considerations and best practices
5. Configuration and deployment instructions
</reasoning_trace>

[üîç Search]

[üåê Browsed]

[üåê Browsed]

[üîç Search]

[üåê Browsed]

[üîç Search]

[üåê Browsed]

[üîç Search]

[üîç Search]

[üåê Browsed]

[üîç Search]

[üåê Browsed]

[üåê Browsed]

[üîç Search]

[‚öôÔ∏è Tool]

# Final Answer

To create a production-ready Node.js MCP server that exposes `ask_perplexity`, `ask_gemini_pro` (with web research), and `ask_gemini_flash` tools, follow this structured approach:

1. **Project Setup & Dependencies**  
   Initialize a TypeScript project, install the MCP SDK, Zod for schemas, and API clients for Perplexity and Google Gemini.

2. **Server Initialization**  
   Create an `McpServer` instance with `stdio` transport and declare capabilities for `tools`.

3. **Tool Schemas**  
   Define Zod schemas for each tool‚Äôs inputs‚Äîquery string, optional model names, and research flags.

4. **Tool Handlers**  
   Implement async handlers that:
   - Validate inputs with Zod  
   - Call Perplexity‚Äôs `/chat/completions` endpoint for `ask_perplexity`  
   - Call Google‚Äôs `generateContent` with `google_search_retrieval` tool for `ask_gemini_pro`  
   - Call `generateContent` without grounding for `ask_gemini_flash`

5. **Tool Registration**  
   Register each tool‚Äôs schema and handler with the server.

6. **Secure Configuration**  
   Load API keys from environment variables, set request timeouts, and use `console.error` for logging.

7. **Run & Test**  
   Build the TypeScript, run via Node, and configure in Claude Desktop or another MCP client.

# Analytical Report

## Background Overview

The Model Context Protocol (MCP) standardizes how AI assistants communicate with external tools and data sources. An MCP server exposes named ‚Äútools‚Äù that an AI assistant can invoke via JSON-RPC over stdio or HTTP. Each tool has a schema describing its parameters and a handler function that executes the logic (e.g., calling an external API).

Node.js implementations leverage the `@modelcontextprotocol/sdk` to:
- Initialize a server instance  
- Define transport (stdio or HTTP)  
- Register request handlers for listing tools (`ListToolsRequestSchema`) and calling tools (`CallToolRequestSchema`)  

TypeScript and Zod are used together to ensure type safety and automatically generate tool schemas from Zod objects. Best practices include:
- Writing logs to `stderr`, not `stdout`, to avoid corrupting JSON-RPC messages  
- Validating all inputs with Zod schemas  
- Wrapping API calls in try/catch and returning structured errors  
- Using environment variables for secrets (API keys)  
- Implementing timeouts and rate limiting to prevent abuse  

Perplexity‚Äôs API provides web-grounded chat completions via an OpenAI-compatible `/chat/completions` endpoint. It supports various models (e.g., `sonar-pro`, `sonar-deep-research`) and returns search-augmented responses with citations.

Google‚Äôs Gemini API offers generative models (e.g., `gemini-3-flash`, `gemini-3-pro`) with optional tool use. Enabling the `google_search_retrieval` tool grounds responses in real-time web search results, returning metadata with supporting links and search suggestions.

## Research Support and Evidence Analysis

Key findings from the research data:

- **MCP Server Structure**  
  The official MCP SDK guide demonstrates creating a server with `stdio` transport, registering tools via `server.setRequestHandler(CallToolRequestSchema, ‚Ä¶)`, and returning `content: [{ type: 'text', text: ‚Ä¶ }]` or errors with `isError: true` [[4](https://modelcontextprotocol.io/docs/develop/build-server)].

- **Node.js Best Practices**  
  A comprehensive Node.js MCP tutorial emphasizes:
  - Using Zod for schema validation  
  - Separating tool definitions and handlers into modules  
  - Securing file operations with path resolution checks  
  - Logging to `console.error` only [[3](https://oneuptime.com/blog/post/2025-12-17-build-mcp-server-nodejs/view)].

- **Perplexity API**  
  The official Perplexity MCP server documentation shows:
  - API key via `PERPLEXITY_API_KEY`  
  - Tools like `perplexity_search`, `perplexity_ask` using Sonar models  
  - OpenAI-compatible `/chat/completions` endpoint with model and messages array [[40](https://github.com/perplexityai/modelcontextprotocol)].

- **Gemini API with Grounding**  
  Google‚Äôs blog post explains enabling `google_search_retrieval` tool for grounded responses. The API returns `groundingMetadata` with sources and suggestions, improving factual accuracy and freshness [[51](https://developers.googleblog.com/en/gemini-api-and-ai-studio-now-offer-grounding-with-google-search)].

- **Security Best Practices**  
  The MCP specification recommends:
  - No sessions for authentication  
  - Enforcing rate limiting to prevent abuse  
  - Proper output encoding  
  - Logging all authorization decisions [[60](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)].

## Data Comparison and Detailed Summary

| Feature                   | Perplexity API                                   | Google Gemini API                                              |
|---------------------------|--------------------------------------------------|---------------------------------------------------------------|
| Endpoint                  | `https://api.perplexity.ai/chat/completions`     | `https://generativelanguage.googleapis.com/v1beta/‚Ä¶`           |
| Authentication            | Bearer token (`PERPLEXITY_API_KEY`)              | API key in header (`x-goog-api-key`)                           |
| Models                    | `sonar-pro`, `sonar-deep-research`, etc.         | `gemini-3-flash`, `gemini-3-pro`                               |
| Web Research              | Built-in (search-augmented completions)          | Via `google_search_retrieval` tool                            |
| Response Metadata         | Citations in `content`                            | `groundingMetadata` with sources and search suggestions       |
| Tool Registration         | Register as MCP tool calling `/chat/completions` | Register as MCP tool calling `generateContent` with tools list |
| Error Handling            | HTTP status & error message in JSON              | HTTP status & error details in JSON                            |

## Source Origin and Reference Interpretation

- **MCP SDK Guide** [[4](https://modelcontextprotocol.io/docs/develop/build-server)]  
  Official documentation from Model Context Protocol. Authoritative for server setup and transport configuration.

- **Node.js MCP Tutorial** [[3](https://oneuptime.com/blog/post/2025-12-17-build-mcp-server-nodejs/view)]  
  Comprehensive third-party tutorial covering project structure, tool schemas, and handlers in TypeScript.

- **Perplexity MCP Server** [[40](https://github.com/perplexityai/modelcontextprotocol)]  
  Official GitHub repository for Perplexity‚Äôs MCP server. Provides tool definitions and environment setup for Perplexity API integration.

- **Gemini Grounding Blog** [[51](https://developers.googleblog.com/en/gemini-api-and-ai-studio-now-offer-grounding-with-google-search)]  
  Google AI Developers Blog announcing the `google_search_retrieval` tool. Authoritative source for enabling web search in Gemini API calls.

- **MCP Security Best Practices** [[60](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)]  
  Official MCP specification section on security. Defines mandatory and recommended practices for authentication, rate limiting, and logging.

## Deep Insights and Independent Thinking

Combining Perplexity and Gemini APIs in a single MCP server offers a powerful hybrid approach:

- **Perplexity for Research-Depth Queries**  
  Sonar models excel at deep research and reasoning, providing comprehensive answers with citations. Ideal for analytical tasks requiring thorough exploration.

- **Gemini for Fast, Grounded Responses**  
  Gemini Flash with `google_search_retrieval` delivers rapid, fact-based answers with inline sources. Suited for real-time information lookup and reducing hallucinations.

- **Unified Interface**  
  Exposing both under a common MCP protocol simplifies client integration. AI assistants can dynamically choose the appropriate tool based on query complexity and required freshness.

- **Cost and Latency Considerations**  
  Perplexity‚Äôs pro models may incur higher costs and latency for deep research. Gemini‚Äôs grounding costs per query (paid tier) but benefits from Google‚Äôs search infrastructure. Implement dynamic routing or fallback mechanisms to optimize performance and cost.

- **Security and Reliability**  
  Use environment variables for API keys and implement request timeouts. Consider proxy support for corporate networks. Monitor usage and enforce rate limits to prevent abuse.

## Extended Discussion

- **Dynamic Tool Selection**  
  Implement a meta-tool that analyzes the user‚Äôs query and routes to `ask_perplexity` or `ask_gemini_pro` based on complexity or domain.

- **Caching Mechanisms**  
  Cache responses for identical queries to reduce API calls and costs, especially for expensive deep-research operations.

- **Advanced Error Handling**  
  Integrate retry logic with exponential backoff for transient failures. Provide detailed error codes and suggestions to the AI assistant.

- **Multi-Modal Capabilities**  
  Extend the server to support image and video inputs using Gemini‚Äôs multimodal models, enabling richer research workflows.

- **Custom Model Tuning**  
  Explore fine-tuning options for both Perplexity and Gemini models to specialize responses for specific domains or use cases.

# Reference List

[3] How to Build an MCP Server in Node.js: A Complete Guide with Best Practices. https://oneuptime.com/blog/post/2025-12-17-build-mcp-server-nodejs/view

[4] Build an MCP server - Model Context Protocol. https://modelcontextprotocol.io/docs/develop/build-server

[40] GitHub - perplexityai/modelcontextprotocol: The official MCP server implementation for the Perplexity API Platform. https://github.com/perplexityai/modelcontextprotocol

[51] Gemini API and Google AI Studio now offer Grounding with Google Search. https://developers.googleblog.com/en/gemini-api-and-ai-studio-now-offer-grounding-with-google-search

[60] Security Best Practices. https://modelcontextprotocol.io/specification/draft/basic/security_best_practices

--- tokens: 2112 out / 19194 in | time: 2026-01-28 03:23:44
