{
  "url": "https://code.claude.com/docs/en/sub-agents",
  "markdown": "# Create custom subagents - Claude Code Docs\n[Skip to main content](#content-area)\n[Claude Code Docs home page![light logo](https://mintcdn.com/claude-code/o69F7a6qoW9vboof/logo/light.svg?fit=max&auto=format&n=o69F7a6qoW9vboof&q=85&s=536eade682636e84231afce2577f9509)![dark logo](https://mintcdn.com/claude-code/o69F7a6qoW9vboof/logo/dark.svg?fit=max&auto=format&n=o69F7a6qoW9vboof&q=85&s=0766b3221061e80143e9f300733e640b)](https://code.claude.com/docs)\n![US](https://d3gk2c5xim1je2.cloudfront.net/flags/US.svg)\nEnglish\nSearch...\n⌘KAsk AI\n-   [Claude Developer Platform](https://platform.claude.com/)\n-   [Claude Code on the Web](https://claude.ai/code)\n-   [\n    Claude Code on the Web\n    ](https://claude.ai/code)\nSearch...\nNavigation\nBuild with Claude Code\nCreate custom subagents\n[Getting started\n](https://code.claude.com/docs/en/overview)[Build with Claude Code\n](https://code.claude.com/docs/en/sub-agents)[Deployment\n](https://code.claude.com/docs/en/third-party-integrations)[Administration\n](https://code.claude.com/docs/en/setup)[Configuration\n](https://code.claude.com/docs/en/settings)[Reference\n](https://code.claude.com/docs/en/cli-reference)[Resources\n](https://code.claude.com/docs/en/legal-and-compliance)\n##### Build with Claude Code\n-   [\n    Create custom subagents\n    ](https://code.claude.com/docs/en/sub-agents)\n-   [\n    Create plugins\n    ](https://code.claude.com/docs/en/plugins)\n-   [\n    Discover and install prebuilt plugins\n    ](https://code.claude.com/docs/en/discover-plugins)\n-   [\n    Extend Claude with skills\n    ](https://code.claude.com/docs/en/skills)\n-   [\n    Output styles\n    ](https://code.claude.com/docs/en/output-styles)\n-   [\n    Hooks\n    ](https://code.claude.com/docs/en/hooks-guide)\n-   [\n    Programmatic usage\n    ](https://code.claude.com/docs/en/headless)\n-   [\n    Model Context Protocol (MCP)\n    ](https://code.claude.com/docs/en/mcp)\n-   [\n    Troubleshooting\n    ](https://code.claude.com/docs/en/troubleshooting)\nOn this page\n-   [Built-in subagents](#built-in-subagents)\n-   [Quickstart: create your first subagent](#quickstart%3A-create-your-first-subagent)\n-   [Configure subagents](#configure-subagents)\n-   [Use the /agents command](#use-the-%2Fagents-command)\n-   [Choose the subagent scope](#choose-the-subagent-scope)\n-   [Write subagent files](#write-subagent-files)\n-   [Supported frontmatter fields](#supported-frontmatter-fields)\n-   [Choose a model](#choose-a-model)\n-   [Control subagent capabilities](#control-subagent-capabilities)\n-   [Available tools](#available-tools)\n-   [Permission modes](#permission-modes)\n-   [Preload skills into subagents](#preload-skills-into-subagents)\n-   [Conditional rules with hooks](#conditional-rules-with-hooks)\n-   [Disable specific subagents](#disable-specific-subagents)\n-   [Define hooks for subagents](#define-hooks-for-subagents)\n-   [Hooks in subagent frontmatter](#hooks-in-subagent-frontmatter)\n-   [Project-level hooks for subagent events](#project-level-hooks-for-subagent-events)\n-   [Work with subagents](#work-with-subagents)\n-   [Understand automatic delegation](#understand-automatic-delegation)\n-   [Run subagents in foreground or background](#run-subagents-in-foreground-or-background)\n-   [Common patterns](#common-patterns)\n-   [Isolate high-volume operations](#isolate-high-volume-operations)\n-   [Run parallel research](#run-parallel-research)\n-   [Chain subagents](#chain-subagents)\n-   [Choose between subagents and main conversation](#choose-between-subagents-and-main-conversation)\n-   [Manage subagent context](#manage-subagent-context)\n-   [Resume subagents](#resume-subagents)\n-   [Auto-compaction](#auto-compaction)\n-   [Example subagents](#example-subagents)\n-   [Code reviewer](#code-reviewer)\n-   [Debugger](#debugger)\n-   [Data scientist](#data-scientist)\n-   [Database query validator](#database-query-validator)\n-   [Next steps](#next-steps)\nBuild with Claude Code\n# Create custom subagents\nCopy page\nCreate and use specialized AI subagents in Claude Code for task-specific workflows and improved context management.\nCopy page\nSubagents are specialized AI assistants that handle specific types of tasks. Each subagent runs in its own context window with a custom system prompt, specific tool access, and independent permissions. When Claude encounters a task that matches a subagent’s description, it delegates to that subagent, which works independently and returns results. Subagents help you:\n-   **Preserve context** by keeping exploration and implementation out of your main conversation\n-   **Enforce constraints** by limiting which tools a subagent can use\n-   **Reuse configurations** across projects with user-level subagents\n-   **Specialize behavior** with focused system prompts for specific domains\n-   **Control costs** by routing tasks to faster, cheaper models like Haiku\nClaude uses each subagent’s description to decide when to delegate tasks. When you create a subagent, write a clear description so Claude knows when to use it. Claude Code includes several built-in subagents like **Explore**, **Plan**, and **general-purpose**. You can also create custom subagents to handle specific tasks. This page covers the [built-in subagents](#built-in-subagents), [how to create your own](#quickstart-create-your-first-subagent), [full configuration options](#configure-subagents), [patterns for working with subagents](#work-with-subagents), and [example subagents](#example-subagents).\n##\n[​\n](#built-in-subagents)\nBuilt-in subagents\nClaude Code includes built-in subagents that Claude automatically uses when appropriate. Each inherits the parent conversation’s permissions with additional tool restrictions.\n-   Explore\n-   Plan\n-   General-purpose\n-   Other\nA fast, read-only agent optimized for searching and analyzing codebases.\n-   **Model**: Haiku (fast, low-latency)\n-   **Tools**: Read-only tools (denied access to Write and Edit tools)\n-   **Purpose**: File discovery, code search, codebase exploration\nClaude delegates to Explore when it needs to search or understand a codebase without making changes. This keeps exploration results out of your main conversation context.When invoking Explore, Claude specifies a thoroughness level: **quick** for targeted lookups, **medium** for balanced exploration, or **very thorough** for comprehensive analysis.\nA research agent used during [plan mode](https://code.claude.com/docs/en/common-workflows#use-plan-mode-for-safe-code-analysis) to gather context before presenting a plan.\n-   **Model**: Inherits from main conversation\n-   **Tools**: Read-only tools (denied access to Write and Edit tools)\n-   **Purpose**: Codebase research for planning\nWhen you’re in plan mode and Claude needs to understand your codebase, it delegates research to the Plan subagent. This prevents infinite nesting (subagents cannot spawn other subagents) while still gathering necessary context.\nA capable agent for complex, multi-step tasks that require both exploration and action.\n-   **Model**: Inherits from main conversation\n-   **Tools**: All tools\n-   **Purpose**: Complex research, multi-step operations, code modifications\nClaude delegates to general-purpose when the task requires both exploration and modification, complex reasoning to interpret results, or multiple dependent steps.\nClaude Code includes additional helper agents for specific tasks. These are typically invoked automatically, so you don’t need to use them directly.\n| Agent | Model | When Claude uses it |\n| --- | --- | --- |\n| Bash | Inherits | Running terminal commands in a separate context |\n| statusline-setup | Sonnet | When you run `/statusline` to configure your status line |\n| Claude Code Guide | Haiku | When you ask questions about Claude Code features |\nBeyond these built-in subagents, you can create your own with custom prompts, tool restrictions, permission modes, hooks, and skills. The following sections show how to get started and customize subagents.\n##\n[​\n](#quickstart:-create-your-first-subagent)\nQuickstart: create your first subagent\nSubagents are defined in Markdown files with YAML frontmatter. You can [create them manually](#write-subagent-files) or use the `/agents` command. This walkthrough guides you through creating a user-level subagent with the `/agent` command. The subagent reviews code and suggests improvements for the codebase.\n1\nOpen the subagents interface\nIn Claude Code, run:\nCopy\nAsk AI\n```\n/agents\n```\n2\nCreate a new user-level agent\nSelect **Create new agent**, then choose **User-level**. This saves the subagent to `~/.claude/agents/` so it’s available in all your projects.\n3\nGenerate with Claude\nSelect **Generate with Claude**. When prompted, describe the subagent:\nCopy\nAsk AI\n```\nA code improvement agent that scans files and suggests improvements\nfor readability, performance, and best practices. It should explain\neach issue, show the current code, and provide an improved version.\n```\nClaude generates the system prompt and configuration. Press `e` to open it in your editor if you want to customize it.\n4\nSelect tools\nFor a read-only reviewer, deselect everything except **Read-only tools**. If you keep all tools selected, the subagent inherits all tools available to the main conversation.\n5\nSelect model\nChoose which model the subagent uses. For this example agent, select **Sonnet**, which balances capability and speed for analyzing code patterns.\n6\nChoose a color\nPick a background color for the subagent. This helps you identify which subagent is running in the UI.\n7\nSave and try it out\nSave the subagent. It’s available immediately (no restart needed). Try it:\nCopy\nAsk AI\n```\nUse the code-improver agent to suggest improvements in this project\n```\nClaude delegates to your new subagent, which scans the codebase and returns improvement suggestions.\nYou now have a subagent you can use in any project on your machine to analyze codebases and suggest improvements. You can also create subagents manually as Markdown files, define them via CLI flags, or distribute them through plugins. The following sections cover all configuration options.\n##\n[​\n](#configure-subagents)\nConfigure subagents\n###\n[​\n](#use-the-/agents-command)\nUse the /agents command\nThe `/agents` command provides an interactive interface for managing subagents. Run `/agents` to:\n-   View all available subagents (built-in, user, project, and plugin)\n-   Create new subagents with guided setup or Claude generation\n-   Edit existing subagent configuration and tool access\n-   Delete custom subagents\n-   See which subagents are active when duplicates exist\nThis is the recommended way to create and manage subagents. For manual creation or automation, you can also add subagent files directly.\n###\n[​\n](#choose-the-subagent-scope)\nChoose the subagent scope\nSubagents are Markdown files with YAML frontmatter. Store them in different locations depending on scope. When multiple subagents share the same name, the higher-priority location wins.\n| Location | Scope | Priority | How to create |\n| --- | --- | --- | --- |\n| `--agents` CLI flag | Current session | 1 (highest) | Pass JSON when launching Claude Code |\n| `.claude/agents/` | Current project | 2 | Interactive or manual |\n| `~/.claude/agents/` | All your projects | 3 | Interactive or manual |\n| Plugin’s `agents/` directory | Where plugin is enabled | 4 (lowest) | Installed with [plugins](https://code.claude.com/docs/en/plugins) |\n**Project subagents** (`.claude/agents/`) are ideal for subagents specific to a codebase. Check them into version control so your team can use and improve them collaboratively. **User subagents** (`~/.claude/agents/`) are personal subagents available in all your projects. **CLI-defined subagents** are passed as JSON when launching Claude Code. They exist only for that session and aren’t saved to disk, making them useful for quick testing or automation scripts:\nCopy\nAsk AI\n```\nclaude --agents '{\n  \"code-reviewer\": {\n    \"description\": \"Expert code reviewer. Use proactively after code changes.\",\n    \"prompt\": \"You are a senior code reviewer. Focus on code quality, security, and best practices.\",\n    \"tools\": [\"Read\", \"Grep\", \"Glob\", \"Bash\"],\n    \"model\": \"sonnet\"\n  }\n}'\n```\nThe `--agents` flag accepts JSON with the same fields as [frontmatter](#supported-frontmatter-fields). Use `prompt` for the system prompt (equivalent to the markdown body in file-based subagents). See the [CLI reference](https://code.claude.com/docs/en/cli-reference#agents-flag-format) for the full JSON format. **Plugin subagents** come from [plugins](https://code.claude.com/docs/en/plugins) you’ve installed. They appear in `/agents` alongside your custom subagents. See the [plugin components reference](https://code.claude.com/docs/en/plugins-reference#agents) for details on creating plugin subagents.\n###\n[​\n](#write-subagent-files)\nWrite subagent files\nSubagent files use YAML frontmatter for configuration, followed by the system prompt in Markdown:\nSubagents are loaded at session start. If you create a subagent by manually adding a file, restart your session or use `/agents` to load it immediately.\nCopy\nAsk AI\n```\n---\nname: code-reviewer\ndescription: Reviews code for quality and best practices\ntools: Read, Glob, Grep\nmodel: sonnet\n---\nYou are a code reviewer. When invoked, analyze the code and provide\nspecific, actionable feedback on quality, security, and best practices.\n```\nThe frontmatter defines the subagent’s metadata and configuration. The body becomes the system prompt that guides the subagent’s behavior. Subagents receive only this system prompt (plus basic environment details like working directory), not the full Claude Code system prompt.\n####\n[​\n](#supported-frontmatter-fields)\nSupported frontmatter fields\nThe following fields can be used in the YAML frontmatter. Only `name` and `description` are required.\n| Field | Required | Description |\n| --- | --- | --- |\n| `name` | Yes | Unique identifier using lowercase letters and hyphens |\n| `description` | Yes | When Claude should delegate to this subagent |\n| `tools` | No | [Tools](#available-tools) the subagent can use. Inherits all tools if omitted |\n| `disallowedTools` | No | Tools to deny, removed from inherited or specified list |\n| `model` | No | [Model](#choose-a-model) to use: `sonnet`, `opus`, `haiku`, or `inherit`. Defaults to `inherit` |\n| `permissionMode` | No | [Permission mode](#permission-modes): `default`, `acceptEdits`, `dontAsk`, `bypassPermissions`, or `plan` |\n| `skills` | No | [Skills](https://code.claude.com/docs/en/skills) to load into the subagent’s context at startup. The full skill content is injected, not just made available for invocation. Subagents don’t inherit skills from the parent conversation |\n| `hooks` | No | [Lifecycle hooks](#define-hooks-for-subagents) scoped to this subagent |\n###\n[​\n](#choose-a-model)\nChoose a model\nThe `model` field controls which [AI model](https://code.claude.com/docs/en/model-config) the subagent uses:\n-   **Model alias**: Use one of the available aliases: `sonnet`, `opus`, or `haiku`\n-   **inherit**: Use the same model as the main conversation\n-   **Omitted**: If not specified, defaults to `inherit` (uses the same model as the main conversation)\n###\n[​\n](#control-subagent-capabilities)\nControl subagent capabilities\nYou can control what subagents can do through tool access, permission modes, and conditional rules.\n####\n[​\n](#available-tools)\nAvailable tools\nSubagents can use any of Claude Code’s [internal tools](https://code.claude.com/docs/en/settings#tools-available-to-claude). By default, subagents inherit all tools from the main conversation, including MCP tools. To restrict tools, use the `tools` field (allowlist) or `disallowedTools` field (denylist):\nCopy\nAsk AI\n```\n---\nname: safe-researcher\ndescription: Research agent with restricted capabilities\ntools: Read, Grep, Glob, Bash\ndisallowedTools: Write, Edit\n---\n```\n####\n[​\n](#permission-modes)\nPermission modes\nThe `permissionMode` field controls how the subagent handles permission prompts. Subagents inherit the permission context from the main conversation but can override the mode.\n| Mode | Behavior |\n| --- | --- |\n| `default` | Standard permission checking with prompts |\n| `acceptEdits` | Auto-accept file edits |\n| `dontAsk` | Auto-deny permission prompts (explicitly allowed tools still work) |\n| `bypassPermissions` | Skip all permission checks |\n| `plan` | Plan mode (read-only exploration) |\nUse `bypassPermissions` with caution. It skips all permission checks, allowing the subagent to execute any operation without approval.\nIf the parent uses `bypassPermissions`, this takes precedence and cannot be overridden.\n####\n[​\n](#preload-skills-into-subagents)\nPreload skills into subagents\nUse the `skills` field to inject skill content into a subagent’s context at startup. This gives the subagent domain knowledge without requiring it to discover and load skills during execution.\nCopy\nAsk AI\n```\n---\nname: api-developer\ndescription: Implement API endpoints following team conventions\nskills:\n  - api-conventions\n  - error-handling-patterns\n---\nImplement API endpoints. Follow the conventions and patterns from the preloaded skills.\n```\nThe full content of each skill is injected into the subagent’s context, not just made available for invocation. Subagents don’t inherit skills from the parent conversation; you must list them explicitly.\nThis is the inverse of [running a skill in a subagent](https://code.claude.com/docs/en/skills#run-skills-in-a-subagent). With `skills` in a subagent, the subagent controls the system prompt and loads skill content. With `context: fork` in a skill, the skill content is injected into the agent you specify. Both use the same underlying system.\n####\n[​\n](#conditional-rules-with-hooks)\nConditional rules with hooks\nFor more dynamic control over tool usage, use `PreToolUse` hooks to validate operations before they execute. This is useful when you need to allow some operations of a tool while blocking others. This example creates a subagent that only allows read-only database queries. The `PreToolUse` hook runs the script specified in `command` before each Bash command executes:\nCopy\nAsk AI\n```\n---\nname: db-reader\ndescription: Execute read-only database queries\ntools: Bash\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-readonly-query.sh\"\n---\n```\nClaude Code [passes hook input as JSON](https://code.claude.com/docs/en/hooks#pretooluse-input) via stdin to hook commands. The validation script reads this JSON, extracts the Bash command, and [exits with code 2](https://code.claude.com/docs/en/hooks#exit-code-2-behavior) to block write operations:\nCopy\nAsk AI\n```\n#!/bin/bash\n# ./scripts/validate-readonly-query.sh\nINPUT=$(cat)\nCOMMAND=$(echo \"$INPUT\" | jq -r '.tool_input.command // empty')\n# Block SQL write operations (case-insensitive)\nif echo \"$COMMAND\" | grep -iE '\\b(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE)\\b' > /dev/null; then\n  echo \"Blocked: Only SELECT queries are allowed\" >&2\n  exit 2\nfi\nexit 0\n```\nSee [Hook input](https://code.claude.com/docs/en/hooks#pretooluse-input) for the complete input schema and [exit codes](https://code.claude.com/docs/en/hooks#simple-exit-code) for how exit codes affect behavior.\n####\n[​\n](#disable-specific-subagents)\nDisable specific subagents\nYou can prevent Claude from using specific subagents by adding them to the `deny` array in your [settings](https://code.claude.com/docs/en/settings#permission-settings). Use the format `Task(subagent-name)` where `subagent-name` matches the subagent’s name field.\nCopy\nAsk AI\n```\n{\n  \"permissions\": {\n    \"deny\": [\"Task(Explore)\", \"Task(my-custom-agent)\"]\n  }\n}\n```\nThis works for both built-in and custom subagents. You can also use the `--disallowedTools` CLI flag:\nCopy\nAsk AI\n```\nclaude --disallowedTools \"Task(Explore)\"\n```\nSee [IAM documentation](https://code.claude.com/docs/en/iam#tool-specific-permission-rules) for more details on permission rules.\n###\n[​\n](#define-hooks-for-subagents)\nDefine hooks for subagents\nSubagents can define [hooks](https://code.claude.com/docs/en/hooks) that run during the subagent’s lifecycle. There are two ways to configure hooks:\n1.  **In the subagent’s frontmatter**: Define hooks that run only while that subagent is active\n2.  **In `settings.json`**: Define hooks that run in the main session when subagents start or stop\n####\n[​\n](#hooks-in-subagent-frontmatter)\nHooks in subagent frontmatter\nDefine hooks directly in the subagent’s markdown file. These hooks only run while that specific subagent is active and are cleaned up when it finishes.\n| Event | Matcher input | When it fires |\n| --- | --- | --- |\n| `PreToolUse` | Tool name | Before the subagent uses a tool |\n| `PostToolUse` | Tool name | After the subagent uses a tool |\n| `Stop` | (none) | When the subagent finishes |\nThis example validates Bash commands with the `PreToolUse` hook and runs a linter after file edits with `PostToolUse`:\nCopy\nAsk AI\n```\n---\nname: code-reviewer\ndescription: Review code changes with automatic linting\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-command.sh $TOOL_INPUT\"\n  PostToolUse:\n    - matcher: \"Edit|Write\"\n      hooks:\n        - type: command\n          command: \"./scripts/run-linter.sh\"\n---\n```\n`Stop` hooks in frontmatter are automatically converted to `SubagentStop` events.\n####\n[​\n](#project-level-hooks-for-subagent-events)\nProject-level hooks for subagent events\nConfigure hooks in `settings.json` that respond to subagent lifecycle events in the main session. Use the `matcher` field to target specific agent types by name.\n| Event | Matcher input | When it fires |\n| --- | --- | --- |\n| `SubagentStart` | Agent type name | When a subagent begins execution |\n| `SubagentStop` | Agent type name | When a subagent completes |\nThis example runs setup and cleanup scripts only when the `db-agent` subagent starts and stops:\nCopy\nAsk AI\n```\n{\n  \"hooks\": {\n    \"SubagentStart\": [\n      {\n        \"matcher\": \"db-agent\",\n        \"hooks\": [\n          { \"type\": \"command\", \"command\": \"./scripts/setup-db-connection.sh\" }\n        ]\n      }\n    ],\n    \"SubagentStop\": [\n      {\n        \"matcher\": \"db-agent\",\n        \"hooks\": [\n          { \"type\": \"command\", \"command\": \"./scripts/cleanup-db-connection.sh\" }\n        ]\n      }\n    ]\n  }\n}\n```\nSee [Hooks](https://code.claude.com/docs/en/hooks) for the complete hook configuration format.\n##\n[​\n](#work-with-subagents)\nWork with subagents\n###\n[​\n](#understand-automatic-delegation)\nUnderstand automatic delegation\nClaude automatically delegates tasks based on the task description in your request, the `description` field in subagent configurations, and current context. To encourage proactive delegation, include phrases like “use proactively” in your subagent’s description field. You can also request a specific subagent explicitly:\nCopy\nAsk AI\n```\nUse the test-runner subagent to fix failing tests\nHave the code-reviewer subagent look at my recent changes\n```\n###\n[​\n](#run-subagents-in-foreground-or-background)\nRun subagents in foreground or background\nSubagents can run in the foreground (blocking) or background (concurrent):\n-   **Foreground subagents** block the main conversation until complete. Permission prompts and clarifying questions (like [`AskUserQuestion`](https://code.claude.com/docs/en/settings#tools-available-to-claude)) are passed through to you.\n-   **Background subagents** run concurrently while you continue working. They inherit the parent’s permissions and auto-deny anything not pre-approved. If a background subagent needs a permission it doesn’t have or needs to ask clarifying questions, that tool call fails but the subagent continues. MCP tools are not available in background subagents.\nIf a background subagent fails due to missing permissions, you can [resume it](#resume-subagents) in the foreground to retry with interactive prompts. Claude decides whether to run subagents in the foreground or background based on the task. You can also:\n-   Ask Claude to “run this in the background”\n-   Press **Ctrl+B** to background a running task\nTo disable all background task functionality, set the `CLAUDE_CODE_DISABLE_BACKGROUND_TASKS` environment variable to `1`. See [Environment variables](https://code.claude.com/docs/en/settings#environment-variables).\n###\n[​\n](#common-patterns)\nCommon patterns\n####\n[​\n](#isolate-high-volume-operations)\nIsolate high-volume operations\nOne of the most effective uses for subagents is isolating operations that produce large amounts of output. Running tests, fetching documentation, or processing log files can consume significant context. By delegating these to a subagent, the verbose output stays in the subagent’s context while only the relevant summary returns to your main conversation.\nCopy\nAsk AI\n```\nUse a subagent to run the test suite and report only the failing tests with their error messages\n```\n####\n[​\n](#run-parallel-research)\nRun parallel research\nFor independent investigations, spawn multiple subagents to work simultaneously:\nCopy\nAsk AI\n```\nResearch the authentication, database, and API modules in parallel using separate subagents\n```\nEach subagent explores its area independently, then Claude synthesizes the findings. This works best when the research paths don’t depend on each other.\nWhen subagents complete, their results return to your main conversation. Running many subagents that each return detailed results can consume significant context.\n####\n[​\n](#chain-subagents)\nChain subagents\nFor multi-step workflows, ask Claude to use subagents in sequence. Each subagent completes its task and returns results to Claude, which then passes relevant context to the next subagent.\nCopy\nAsk AI\n```\nUse the code-reviewer subagent to find performance issues, then use the optimizer subagent to fix them\n```\n###\n[​\n](#choose-between-subagents-and-main-conversation)\nChoose between subagents and main conversation\nUse the **main conversation** when:\n-   The task needs frequent back-and-forth or iterative refinement\n-   Multiple phases share significant context (planning → implementation → testing)\n-   You’re making a quick, targeted change\n-   Latency matters. Subagents start fresh and may need time to gather context\nUse **subagents** when:\n-   The task produces verbose output you don’t need in your main context\n-   You want to enforce specific tool restrictions or permissions\n-   The work is self-contained and can return a summary\nConsider [Skills](https://code.claude.com/docs/en/skills) instead when you want reusable prompts or workflows that run in the main conversation context rather than isolated subagent context.\nSubagents cannot spawn other subagents. If your workflow requires nested delegation, use [Skills](https://code.claude.com/docs/en/skills) or [chain subagents](#chain-subagents) from the main conversation.\n###\n[​\n](#manage-subagent-context)\nManage subagent context\n####\n[​\n](#resume-subagents)\nResume subagents\nEach subagent invocation creates a new instance with fresh context. To continue an existing subagent’s work instead of starting over, ask Claude to resume it. Resumed subagents retain their full conversation history, including all previous tool calls, results, and reasoning. The subagent picks up exactly where it stopped rather than starting fresh. When a subagent completes, Claude receives its agent ID. To resume a subagent, ask Claude to continue the previous work:\nCopy\nAsk AI\n```\nUse the code-reviewer subagent to review the authentication module\n[Agent completes]\nContinue that code review and now analyze the authorization logic\n[Claude resumes the subagent with full context from previous conversation]\n```\nYou can also ask Claude for the agent ID if you want to reference it explicitly, or find IDs in the transcript files at `~/.claude/projects/{project}/{sessionId}/subagents/`. Each transcript is stored as `agent-{agentId}.jsonl`. Subagent transcripts persist independently of the main conversation:\n-   **Main conversation compaction**: When the main conversation compacts, subagent transcripts are unaffected. They’re stored in separate files.\n-   **Session persistence**: Subagent transcripts persist within their session. You can [resume a subagent](#resume-subagents) after restarting Claude Code by resuming the same session.\n-   **Automatic cleanup**: Transcripts are cleaned up based on the `cleanupPeriodDays` setting (default: 30 days).\n####\n[​\n](#auto-compaction)\nAuto-compaction\nSubagents support automatic compaction using the same logic as the main conversation. By default, auto-compaction triggers at approximately 95% capacity. To trigger compaction earlier, set `CLAUDE_AUTOCOMPACT_PCT_OVERRIDE` to a lower percentage (for example, `50`). See [environment variables](https://code.claude.com/docs/en/settings#environment-variables) for details. Compaction events are logged in subagent transcript files:\nCopy\nAsk AI\n```\n{\n  \"type\": \"system\",\n  \"subtype\": \"compact_boundary\",\n  \"compactMetadata\": {\n    \"trigger\": \"auto\",\n    \"preTokens\": 167189\n  }\n}\n```\nThe `preTokens` value shows how many tokens were used before compaction occurred.\n##\n[​\n](#example-subagents)\nExample subagents\nThese examples demonstrate effective patterns for building subagents. Use them as starting points, or generate a customized version with Claude.\n**Best practices:**\n-   **Design focused subagents:** each subagent should excel at one specific task\n-   **Write detailed descriptions:** Claude uses the description to decide when to delegate\n-   **Limit tool access:** grant only necessary permissions for security and focus\n-   **Check into version control:** share project subagents with your team\n###\n[​\n](#code-reviewer)\nCode reviewer\nA read-only subagent that reviews code without modifying it. This example shows how to design a focused subagent with limited tool access (no Edit or Write) and a detailed prompt that specifies exactly what to look for and how to format output.\nCopy\nAsk AI\n```\n---\nname: code-reviewer\ndescription: Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.\ntools: Read, Grep, Glob, Bash\nmodel: inherit\n---\nYou are a senior code reviewer ensuring high standards of code quality and security.\nWhen invoked:\n1. Run git diff to see recent changes\n2. Focus on modified files\n3. Begin review immediately\nReview checklist:\n- Code is clear and readable\n- Functions and variables are well-named\n- No duplicated code\n- Proper error handling\n- No exposed secrets or API keys\n- Input validation implemented\n- Good test coverage\n- Performance considerations addressed\nProvide feedback organized by priority:\n- Critical issues (must fix)\n- Warnings (should fix)\n- Suggestions (consider improving)\nInclude specific examples of how to fix issues.\n```\n###\n[​\n](#debugger)\nDebugger\nA subagent that can both analyze and fix issues. Unlike the code reviewer, this one includes Edit because fixing bugs requires modifying code. The prompt provides a clear workflow from diagnosis to verification.\nCopy\nAsk AI\n```\n---\nname: debugger\ndescription: Debugging specialist for errors, test failures, and unexpected behavior. Use proactively when encountering any issues.\ntools: Read, Edit, Bash, Grep, Glob\n---\nYou are an expert debugger specializing in root cause analysis.\nWhen invoked:\n1. Capture error message and stack trace\n2. Identify reproduction steps\n3. Isolate the failure location\n4. Implement minimal fix\n5. Verify solution works\nDebugging process:\n- Analyze error messages and logs\n- Check recent code changes\n- Form and test hypotheses\n- Add strategic debug logging\n- Inspect variable states\nFor each issue, provide:\n- Root cause explanation\n- Evidence supporting the diagnosis\n- Specific code fix\n- Testing approach\n- Prevention recommendations\nFocus on fixing the underlying issue, not the symptoms.\n```\n###\n[​\n](#data-scientist)\nData scientist\nA domain-specific subagent for data analysis work. This example shows how to create subagents for specialized workflows outside of typical coding tasks. It explicitly sets `model: sonnet` for more capable analysis.\nCopy\nAsk AI\n```\n---\nname: data-scientist\ndescription: Data analysis expert for SQL queries, BigQuery operations, and data insights. Use proactively for data analysis tasks and queries.\ntools: Bash, Read, Write\nmodel: sonnet\n---\nYou are a data scientist specializing in SQL and BigQuery analysis.\nWhen invoked:\n1. Understand the data analysis requirement\n2. Write efficient SQL queries\n3. Use BigQuery command line tools (bq) when appropriate\n4. Analyze and summarize results\n5. Present findings clearly\nKey practices:\n- Write optimized SQL queries with proper filters\n- Use appropriate aggregations and joins\n- Include comments explaining complex logic\n- Format results for readability\n- Provide data-driven recommendations\nFor each analysis:\n- Explain the query approach\n- Document any assumptions\n- Highlight key findings\n- Suggest next steps based on data\nAlways ensure queries are efficient and cost-effective.\n```\n###\n[​\n](#database-query-validator)\nDatabase query validator\nA subagent that allows Bash access but validates commands to permit only read-only SQL queries. This example shows how to use `PreToolUse` hooks for conditional validation when you need finer control than the `tools` field provides.\nCopy\nAsk AI\n```\n---\nname: db-reader\ndescription: Execute read-only database queries. Use when analyzing data or generating reports.\ntools: Bash\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-readonly-query.sh\"\n---\nYou are a database analyst with read-only access. Execute SELECT queries to answer questions about the data.\nWhen asked to analyze data:\n1. Identify which tables contain the relevant data\n2. Write efficient SELECT queries with appropriate filters\n3. Present results clearly with context\nYou cannot modify data. If asked to INSERT, UPDATE, DELETE, or modify schema, explain that you only have read access.\n```\nClaude Code [passes hook input as JSON](https://code.claude.com/docs/en/hooks#pretooluse-input) via stdin to hook commands. The validation script reads this JSON, extracts the command being executed, and checks it against a list of SQL write operations. If a write operation is detected, the script [exits with code 2](https://code.claude.com/docs/en/hooks#exit-code-2-behavior) to block execution and returns an error message to Claude via stderr. Create the validation script anywhere in your project. The path must match the `command` field in your hook configuration:\nCopy\nAsk AI\n```\n#!/bin/bash\n# Blocks SQL write operations, allows SELECT queries\n# Read JSON input from stdin\nINPUT=$(cat)\n# Extract the command field from tool_input using jq\nCOMMAND=$(echo \"$INPUT\" | jq -r '.tool_input.command // empty')\nif [ -z \"$COMMAND\" ]; then\n  exit 0\nfi\n# Block write operations (case-insensitive)\nif echo \"$COMMAND\" | grep -iE '\\b(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE|MERGE)\\b' > /dev/null; then\n  echo \"Blocked: Write operations not allowed. Use SELECT queries only.\" >&2\n  exit 2\nfi\nexit 0\n```\nMake the script executable:\nCopy\nAsk AI\n```\nchmod +x ./scripts/validate-readonly-query.sh\n```\nThe hook receives JSON via stdin with the Bash command in `tool_input.command`. Exit code 2 blocks the operation and feeds the error message back to Claude. See [Hooks](https://code.claude.com/docs/en/hooks#simple-exit-code) for details on exit codes and [Hook input](https://code.claude.com/docs/en/hooks#pretooluse-input) for the complete input schema.\n##\n[​\n](#next-steps)\nNext steps\nNow that you understand subagents, explore these related features:\n-   [Distribute subagents with plugins](https://code.claude.com/docs/en/plugins) to share subagents across teams or projects\n-   [Run Claude Code programmatically](https://code.claude.com/docs/en/headless) with the Agent SDK for CI/CD and automation\n-   [Use MCP servers](https://code.claude.com/docs/en/mcp) to give subagents access to external tools and data\nWas this page helpful?\nYesNo\n[Create plugins](https://code.claude.com/docs/en/plugins)\n⌘I\n[Claude Code Docs home page![light logo](https://mintcdn.com/claude-code/o69F7a6qoW9vboof/logo/light.svg?fit=max&auto=format&n=o69F7a6qoW9vboof&q=85&s=536eade682636e84231afce2577f9509)![dark logo](https://mintcdn.com/claude-code/o69F7a6qoW9vboof/logo/dark.svg?fit=max&auto=format&n=o69F7a6qoW9vboof&q=85&s=0766b3221061e80143e9f300733e640b)](https://code.claude.com/docs)\n[x](https://x.com/AnthropicAI)[linkedin](https://www.linkedin.com/company/anthropicresearch)\nCompany\n[Anthropic](https://www.anthropic.com/company)[Careers](https://www.anthropic.com/careers)[Economic Futures](https://www.anthropic.com/economic-futures)[Research](https://www.anthropic.com/research)[News](https://www.anthropic.com/news)[Trust center](https://trust.anthropic.com/)[Transparency](https://www.anthropic.com/transparency)\nHelp and security\n[Availability](https://www.anthropic.com/supported-countries)[Status](https://status.anthropic.com/)[Support center](https://support.claude.com/)\nLearn\n[Courses](https://www.anthropic.com/learn)[MCP connectors](https://claude.com/partners/mcp)[Customer stories](https://www.claude.com/customers)[Engineering blog](https://www.anthropic.com/engineering)[Events](https://www.anthropic.com/events)[Powered by Claude](https://claude.com/partners/powered-by-claude)[Service partners](https://claude.com/partners/services)[Startups program](https://claude.com/programs/startups)\nTerms and policies\n[Privacy policy](https://www.anthropic.com/legal/privacy)[Disclosure policy](https://www.anthropic.com/responsible-disclosure-policy)[Usage policy](https://www.anthropic.com/legal/aup)[Commercial terms](https://www.anthropic.com/legal/commercial-terms)[Consumer terms](https://www.anthropic.com/legal/consumer-terms)",
  "timestamp": 1769086200554,
  "title": "Create custom subagents - Claude Code Docs"
}