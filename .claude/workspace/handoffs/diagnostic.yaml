---
date: 2026-01-29
session: internal-review-system-2026-01-29
type: diagnostic
status: complete
outcome: IN_PROGRESS
severity: high
---
goal: Document findings from comprehensive system review of .claude/ components vs rules files
now: Apply prioritized fixes based on clarified rules
test: ls .claude/workspace/handoffs/*.yaml

## User Clarification

**On Progressive Disclosure**: Does NOT apply to commands.
**On @path in Commands**: Commands MUST use @path injection to prevent context drift risk.

This changes the analysis - commands using @path are CORRECT behavior, not violations.

## Critical Issues (Real)

| # | Issue | Severity | Files |
|---|-------|----------|-------|
| 1 | CLAUDE.md self-contradiction | CRITICAL | CLAUDE.md:10-15 vs :211 |
| 2 | Progressive disclosure scope | CRITICAL | principles.md:350 vs architecture.md:277-300 |
| 3 | 5 agents missing sections | HIGH | security-auditor, skill-auditor, slash-command-auditor, toolkit-worker, subagent-auditor |
| 4 | jules/status.md format violations | HIGH | jules/status.md |
| 5 | Hooks missing timeouts | HIGH | settings.json |

## Issues Reclassified as ACCEPTABLE

| Issue | Previous Assessment | Corrected Assessment |
|-------|--------------------|--------------------|
| Commands using @path injection | VIOLATION | CORRECT - commands must use @path to prevent context drift |
| Skills Genetic Code referencing .claude/rules | VIOLATION | ACCEPTABLE - meta-documentation, self-contained philosophy |

## Resolution Plan

### Priority 1 (Immediate)

1. **Fix CLAUDE.md contradiction**
   - Remove lines 10-15 (cross-reference table to rules) OR
   - Remove line 211 (no cross-references constraint)

2. **Fix architecture.md vs principles.md contradiction**
   - Update architecture.md to align with principles.md
   - Progressive disclosure applies ONLY to skills

### Priority 2

3. **Fix 5 non-compliant agents**
   - Add missing sections to:
     - security-auditor.md
     - skill-auditor.md
     - slash-command-auditor.md
     - toolkit-worker.md
     - subagent-auditor.md

4. **Fix jules/status.md**
   - Correct description format (imperative voice, Use when/Not for)
   - Remove explicit file path reference

### Priority 3

5. **Fix hooks in settings.json**
   - Add timeout to SessionStart hook
   - Add timeout to PostToolUse hook
   - Verify matcher syntax

## Verification Checklist

- [ ] CLAUDE.md contradiction resolved
- [ ] Progressive disclosure scope clarified in architecture.md
- [ ] 5 agents updated with required sections
- [ ] jules/status.md description format fixed
- [ ] Hooks have timeouts

## Notes

**User Requirement**: Commands MUST use @path injection to prevent context drift. This is intentional design, not a violation.

**Progressive Disclosure Scope**: ONLY skills. Commands are single-file, always load full content.

---

## Session: session-start-refinement-2026-01-29

**Date**: 2026-01-29
**Type**: diagnostic
**Status**: complete
**Outcome**: COMPLETED
**Severity**: medium

### Goal

Refine session-start.sh with research-backed skill invocation enforcement

### User Clarification

**On skill threshold quantification**: LLMs respond well to explicit numerical thresholds and chain-of-thought evaluation patterns. Research shows:
- Quantitative framing ("10x") improves adherence
- Confidence rating (0-100) forces explicit evaluation
- Explicit thresholds ("<90%") reduce ambiguity
- Chain-of-thought steps improve reasoning compliance

### Changes Applied

1. **Semantic script improvements**
   - Renamed variables for clarity (`SESSION_DIR` → `SESSION_BASE_DIR`, etc.)
   - Added section delimiters (`--- Configuration ---`)
   - Function renamed (`json_escape` → `escape_for_json`)
   - Added `local` variable declaration

2. **Discipline content refinement**
   - Reduced from 2,962 → 913 characters (69% reduction)
   - Added 10x skill sensitivity elevation
   - Implemented CoT confidence rating (0-100, <90% threshold)
   - Preserved strong language enforcement
   - "1% chance" updated to "remotest chance"

3. **Output JSON enhancement**
   - Added `sessionId` field
   - Added `version: "1.0"` for compatibility tracking
   - Renamed `additionalContext` → `injectedContext`

### Files Modified

- `.claude/scripts/session-start.sh`

### Test

```bash
cat .claude/scripts/session-start.sh | grep -A 5 "SKILL SENSITIVITY"
```

### Still Unresolved

- Hook timeouts in settings.json (Priority 3 in main diagnostic)
